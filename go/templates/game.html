{% extends "base.html" %}

{% load jsonify %}


{% block content %}

<h1>{{ kifu }}</h1>

<script>
    var game = {{ game | jsonify }}

    jQuery(function ($) {
        var x, y,
            classes,
            star,
            $el = $('<div class="game-play-area"></div>'),
            $board = $('<div class="go-board"></div>'),
            $board_inner = $('<div class="inner"></div>'),
            $interaction_layer = $('<div class="interaction-layer"></div>');

        $board.append($board_inner);
        $el.append($board);
        $el.append($interaction_layer);
        $('body').append($el);

        // Build the board, the visible part
        for (x = 1; x <= game.board_size - 1; x++) {
            for (y = 1; y <= game.board_size - 1; y++) {
                classes = ['cell', 'cell-' + x + '-' + y + ''];

                star = '';

                if ((x - 4) % 6 == 0 && (y - 4) % 6 == 0) {
                    star = '<div class="star"></div>';
                }

                $board_inner.append([
                    '<div class="', classes.join(' ') ,'">',
                        star,
                        '<span class="label">', x, ',', y, '</span>',
                    '</div>'].join('')
                );
            }
        }

        // Build the board, the visible part
        for (x = 1; x <= game.board_size; x++) {
            for (y = 1; y <= game.board_size; y++) {
                classes = ['btn', 'btn-' + x + '-' + y + '']
                $interaction_layer.append([
                    '<div class="', classes.join(' ') ,'" ',
                         'data-x="', x, '" data-y="', y, '">',
                    '</div>'
                ].join(''));
            }
        }

        // Yucky rough click handling
        var color = 'black';
        $interaction_layer.find('.btn').click(function () {
            var $btn = $(this);

            $btn.append('<div class="stone stone-' + color + '"></div>');
            color = color === 'black' ? 'white' : 'black';

            $.ajax({
                method: 'POST',
                url: '/' + game.id + '/play',
                data: {
                    x: $btn.data('x'),
                    y: $btn.data('y')
                },
            });
        });
    });
</script>

{% endblock %}